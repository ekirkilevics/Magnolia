<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <title>All modules</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link href="${this.request.contextPath}/.resources/admin-css/admin-all.css" type="text/css" rel="stylesheet" />
    <style type="text/css">
      body#mgnl {
        margin: 0;
        padding: 0;
      }
    </style>
    <script src="${this.request.contextPath}/.magnolia/pages/javascript.js" type="text/javascript"><!-- --></script>
    <script type="text/javascript">
      function checkAgreement(){
          var cookieName = 'mgnlStoreAgreementToConnect';
          var agreed = getCookie(cookieName);
          if(agreed){
              loadModules();
          } else {
              elem = document.getElementById('infoAgreement');
              elem.style.display = '';
          }
      }
      function setAnswer(answer){
          var cookieName = 'mgnlStoreAgreementToConnect';
          if(answer.id=='yes'){
              setCookie(cookieName,'okie',365);
              loadModules();
          } else {
              window.parent.location.href='${this.request.contextPath}/.magnolia/pages/adminCentral.html';
          }
      }
      function loadModules(){
          document.getElementById('infoAgreement').style.display='none';
          document.getElementById('loading').style.display = '';
          setTimeout('', 1000);
          document.getElementById('loadModulesForm').submit();
      }
      function setCookie(cookieName,value,expiredays){
        var exdate=new Date();
        exdate.setDate(exdate.getDate()+expiredays);
        document.cookie=cookieName+ "=" +escape(value)+
        ((expiredays==null) ? "" : ";expires="+exdate.toGMTString());
      }
      function getCookie(cookieName) {
        if (document.cookie.length>0) {
          c_start=document.cookie.indexOf(cookieName + "=");
          if (c_start!=-1) {
            c_start=c_start + cookieName+1;
            c_end=document.cookie.indexOf(";",c_start);
            if (c_end==-1) c_end=document.cookie.length;
            return unescape(document.cookie.substring(c_start,c_end));
            }
          }
        return "";
      }
    </script>
  </head>
  <body id="mgnl" onload="checkAgreement();" style="background-color:#fff">
    <form id="loadModulesForm" action="${this.remoteUrl}" method="post">
      <div>
        <input type="hidden" name="postdata" value="${this.postdata}" />
      </div>
    </form>
    <div id ="infoAgreement" style="display: none; width: 400px; margin: 50px auto;">
      <h3 style="border: none">The Magnolia Store Module needs to submit some information about your installed modules to an external server. If you agree, a cookie will be saved in your browser to store your response. Do you wish to continue? </h3>
       <input  name="yes" id="yes" type="button" value="Yes, continue" onclick="setAnswer(this); return false;" class="mgnlControlButton"/>
       <input  name="no" id="no" type="button" value="No, thanks" onclick="setAnswer(this); return false;" class="mgnlControlButton"/>
    </div>
    <div id ="loading" style="display: none; width: 400px; margin: 50px auto; text-align: center;">
      <h2>Contacting server...</h2>
      <img src="${this.request.contextPath}/.resources/admin-images/loading.gif" alt="Loading..." />
    </div>
  </body>
</html>