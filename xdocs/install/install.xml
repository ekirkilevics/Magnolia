<?xml version="1.0"?>
<document>
    <properties>
        <title>Installing Magnolia</title>
        <author email="fgiust(at)users.sourceforge.net">Fabrizio Giustina</author>
    </properties>
    <body>
        <section name="Installing 2.1 bundled with tomcat">
        <p>This is the easy way and you should start with this installation if you are new to magnolia.
        <ol>
        	<li>download the bundle from <a href="http://sourceforge.net/project/showfiles.php?group_id=86297">sourceforge</a></li>
        	<li>unzip the file</li>
        	<li>start the bundeld tomcat (bin/startup.sh or bin/startup.bat)</li>
        	<li>wait ....</li>
        	<li>connect to localhost:8081/magnoliaAuthor or localhost:8081/magnoliaPublic</li>
        	<li>login as superuser (password is 'superuser')</li>
        </ol>
        From the release notes:
        <source>
        <![CDATA[
=============================================== 
System Requirements
===============================================

To run magnolia, all you need is Java 1.4.2.x
We bundle tomcat as a J2EE application server for
your convenience but other J2EE servers should 
work as well.

The authoring environment will need a browser. The
latest list of tested and compliant browsers can 
be found at www.magnolia.info


=============================================== 
Installation & setup: starting magnolia
===============================================

After unzipping, you will have to start the two
magnolia instances in one step

1. Starting the Instances

1.1. Unix (all flavors)

  open a shell and set the environment variables
  JAVA_HOME and preferably CATALINA_HOME. If you
  do not set CATALINA_HOME, you will have to 
  start magnolia from within the bin/ directory
 
    > sh
    > cd INSTALL_DIRECTORY/tomcat/bin
    > export JAVA_HOME=YOUR_JAVA1.4_HOME
    > ./startup.sh


  Here is an example of a small shell script 
  that you could use to start the authoring instance
 
  --------- 8< ---------
  #!/bin/sh
  #
  # start admin instance
  #
  export JAVA_HOME=/Library/Java/Home
  cd INSTALL_DIRECTORY/tomcat/bin
  ./startup.sh
  --------- 8< ---------


1.2. Microsoft Windows

  open command prompt 
    > C:\set JAVA_HOME=YOUR_JAVA1.4_HOME
    > C:\INSTALL_DIRECTORY\tomcat\bin\startup.bat


=============================================== 
Connecting to magnolia
=============================================== 

Note : Authoring and Public instance must be 
running before you can access these URL's
this will take a few minutes to initialize 
the repositories.

To start using the magnolia public environment, 
open a browser and goto 
http://localhost:8081/magnoliaPublic

To edit configuration on public instance go to
http://localhost:8081/magnoliaPublic/.magnolia and login as 
superuser.

To start using the magnolia authoring environment, 
open a browser and goto 
http://localhost:8081/magnoliaAuthor

The default username & password are:

- username : superuser
- password : superuser        
        ]]>
        </source>
        </p>
        </section>
        <section name="Installing 2.1 wars distribution and nightly builds">
            <strong>
                Warning: this steps only apply to the Magnolia 2.1 distribution. Refer to the appropriate documentation
                for previous versions.
            </strong>
            <subsection name="Getting an application servers">
                <p>
                    Magnolia requires a servlet 2.4 compatible servlet container and a 1.4 level jre/jdk (depending on
                    the server requisites) in oder to run properly. The suggested server is Apache Tomcat 5.x.
                </p>
                <p>
                    In order to install Magnolia 2.1 you will need to setup a working application server instance,
                    Tomcat is NOT bundled in the distribution.
                </p>
            </subsection>
            <subsection name="Deploying Magnolia">
                <p>
                    After downloading the latest Magnolia war or compiling it from subversion all you need to do is
                    dropping it to the server
                    <code>webapps</code>
                    directory. At the first run Magnolia will automatically generate a default repository and import
                    content from a set of xml file. This process is known as "bootstrapping".
                </p>
                <p>
                    <strong>
                        Warning: since bootstrapping could require a large amount of memory, be sure to set the maximum
                        memory available to the server to at least 256MB (usually passing the -Xmx256m parameter to the
                        java process). If an OutOfMemory error pops up in the console during the bootstrap process you
                        will need to remove the magnolia webapp and redeploy it since bootstrap will not be repeated if
                        a partial repository has already been loaded.
                    </strong>
                </p>
                <p>
                    Also note that Magnolia requires to be unzipped in order to work properly. Most of the application
                    server automatically unzip wars while deploying them: if you run Magnolia on an application server
                    which is able to run zipped wars you will need to unpack it manually.
                </p>
            </subsection>
            <subsection name="Testing the installation">
                <p>
                    Open your favorite browser and go to http://[server name]:[port]/[war name]. That means, for a
                    default installation, http://localhost:8080/magnolia. You should see a login prompt, use
                    <code>superuser</code>
                    as login/password and welcome to the magnolia admin interface.
                </p>
                <p>
                    If you can't see anything probably the bootstrap process failed. Check you server logs for errors,
                    the most common reason for a failure is an OutOfMemory error during bootstrap.
                </p>
            </subsection>
            <subsection name="Multiple installation and advanced configuration">
                <p>
                    Multiple instances of Magnolia 2.1 can now work on the same server (previous versions required to be
                    bound to the root context).
                </p>
                <p>
                    The core Magnolia configuration is done in web.xml. By default, all the repositories, logs and
                    working folders are created inside the webapp, so the standard configuration is mostly ok for
                    running multiple wars under the same server.
                </p>
                <p>
                    <strong>
                        There is a single configuration you will usually need to change when deploying multiple Magnolia
                        wars on the same server, which is needed in order configure logging properly.
                    </strong>
                    In order to setup absolute paths for log4j Magnolia need to pass the webapp root to a system
                    property which is then used in the log4j.xml config file. Some application server (e.g. Tomcat)
                    share system variables between different webapp, so you will need to change the variable name to a
                    unique name.
                </p>
                <p>
                    The system variable name is defined by the
                    <code>magnolia.root.sysproperty</code>
                    parameter in web.xml and it's usually set to
                    <code>magnolia.root</code>
                    . In order to run a second instance under the same server you will need to change it to e.g.
                    <code>magnolia2.root</code>
                    both in web.xml and config/log4j.xml.
                </p>
                <p>
                    Note that the magnolia root system property is only needed to configure logging, so you can freely
                    remove it if you are using a different log4j configuration (for example a shared configuration for
                    all the server or a JMS based appender).
                </p>
            </subsection>
        </section>
    </body>
</document>
