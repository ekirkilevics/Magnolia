<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <title>Repository browser page</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link href="${this.request.contextPath}/.resources/admin-css/admin-all.css" type="text/css" rel="stylesheet" />
    <script language="javascript" type="text/javascript">
      // <!-- 
    
        function update(repository) {
          var pathSelected = [#if this.selectedPath?exists]"${this.selectedPath}"[#else]null[/#if];
          
          var src = "${ctx.contextPath}/.magnolia/pages/linkBrowser.html?repository=" + repository;
          if (pathSelected) src += "&pathSelected=" + pathSelected;
          
          document.getElementById("frmTree").src = src;
          
          // set the callback
          top.mgnlCallBackCommand = {
            callback: function(value) {
                  var pathInput = document.getElementById("selectedPath");
                  pathInput.value = value;
                  
                  var treeSelectionForm = document.getElementById("treeSelection");
                  treeSelectionForm.submit();
                  
                  return false;
              }
          };
        }
        
        function resize() {
          window.resizeTo(400, 535);
          window.focus();
        }
      // -->
    </script>
  </head>
  <body onload="resize();update(document.getElementById('selectedRepository').value);" class="mgnlBgDark" id="mgnl">
    <form id="treeSelection" style="padding-left: 5px; padding-top: 10px;" action="" method="get">
      <input id="selectedPath" name="selectedPath" value="test" type="hidden"/>
      <input name="command" value="resolveAbsoluteURI" type="hidden"/>
      
      <label for="selectedRepository" class="mgnlText">Repository:</label>
      <select id="selectedRepository" name="selectedRepository" onchange="update(this.value);">
      [#list this.repositories as repository]
        <option value="${repository.name}" [#if this.selectedRepository?exists && this.selectedRepository == repository.name]selected="selected"[/#if]>${repository.i18nLabel}</option>
      [/#list]
      </select>
    </form> 
    <iframe id="frmTree" name="frmTree" src="" width="100%" height="400" frameborder="0" marginheight="0" marginwidth="0" scrolling="no"/>
  </body>
</html>