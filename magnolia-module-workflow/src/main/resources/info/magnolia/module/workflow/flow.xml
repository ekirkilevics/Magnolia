<process-definition name="activation" revision="j0.0.2">
    <sequence>
        <log message="test"/>
        <!--  go to publisher first -->
        <participant ref="group-publisher" />

        <!-- will loop if rejected -->
        <if test="${field:action} == reject">
            <revision-round/>
        </if>

        
        <log message="activate: ${field:action}"/>
        
        <!-- if the last action was proceed: activate-->
        <if test="${field:action} == proceed">
            <activate/>
        </if>
    </sequence>

    <process-definition name="revision-round">
        <loop>

            <while test="${field:action} == reject"/>

            <to-editor/>

            <if test="${field:action} != proceed">
                <break/>
            </if>

            <to-publisher/>
        </loop>

    </process-definition>
  
  <process-definition name="to-publisher">
        <participant ref="group-publisher" />
  </process-definition>

    <process-definition name="to-editor">
        <participant ref="group-editor" />
    </process-definition>

    <process-definition name="activate">
        <sequence>
            <!--  wait if scheduled -->
            <if>
                <defined field-value="startDate"/>

                <sleep until="${f:startDate}"/>
            </if>
    
            <!-- activate -->
            <participant ref="command-activate" />
    
            <if>
                <defined field-value="exception"/>
                <!--  restart again -->
                <activation/>
                <break/>
            </if>
            
            <!-- deactivate (if scheduled)-->
            <if>
                <defined field-value="endDate"/>
                <sequence>
                    <sleep until="${f:endDate}"/>
                    <participant ref="command-deactivate"/>
                </sequence>
            </if>

        </sequence>
    </process-definition>
    
</process-definition>