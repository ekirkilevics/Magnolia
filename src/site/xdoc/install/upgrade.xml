<?xml version="1.0" encoding="UTF-8"?>
<document>
    <properties>
        <title>Upgrade</title>
    </properties>
    <body>
        <section name="Upgrade">
            <subsection name="From 2.1RC1 or above to 2.1">
                <p>
                    Follow the same procedure as described in the section 'From 2.03 to 2.1'. As an
                    alternative you can use the import export feature available since 2.1-RC1.
                </p>
            </subsection>

            <subsection name="From 2.03 to 2.1">
                <p>
                    Be shure that you upgraded your 2.0 installation to 2.03 before you try to
                    migrate.
                    <b>Do not copy repositories!</b>
                    Repositories changed since JCR was not final when we made the 2.0 release and
                    Jackrabbit is not yet final too.
                    <br />
                    The main steps are: install 2.1, boostrap 2.1, activate old content from the
                    2.0.3 instance to the new 2.1 instance. The old and the new istance must use
                    different ports. You can change it in the server.xml of the tomcat installation!
                    <ol>
                        <li>Install 2.1</li>
                        <li>Start it up. The initialization is done during bootstraping.</li>
                        <li>Check the 2.1 installation. Does everything work?</li>
                        <li>
                            Set the subscriber of the old installation to the new one. Before you
                            start up the older version, check if the port is not the same as of the
                            new installation. You can change the port in the server.xml of the
                            tomcat.
                        </li>
                        <li>Now activate the old content. Active also the templates and dialogs</li>
                        <li>
                            Copy your custom stuff (jsps and other documents) to the new
                            installation
                        </li>
                    </ol>
                </p>
            </subsection>

            <subsection name="From 2.0 to 2.0.3">
                <p>Follow the instructions of the 2.0.1 (valid for 2.0.3 too) release notes</p>
                <source>
                    <![CDATA[
This is a maintenance release. If you need an installer including tomcat, download 2.0. install it, then download this version (2.0.1).
Then for both the author and public instances, do:

- delete the existing "webapps/magnolia"
- copy (or unzip depending on your system) the new magnolia.war into "webapps/magnolia"

Start tomcat as usual. It will unzip the war file and you are ready to go.

In case of existing installations, be careful not to overwrite your repository or templates. Your safest bet is to:

For both the author and public instance:
- rename the existing "webapps/magnolia" directory to "magnolia.old"
- unzip the new magnolia.war into "webapps/magnolia"
- move the "repositories" directory from "magnolia.old" to "magnolia"
- diff the new and the old magnolia to copy what you need (ignore the repository for that, you will want your existing one)

When updating from an earlier installation, please note that taglib definitions in WEB.xml are no longer needed since jsp 1.1.
The application server automatically scans jar files in WEB-INF/lib and
extract all the tlds. To refer to a particular taglib you can simply use the URI exactly as it has been defined in the tld.

The magnolia samples before release 2.0.1 have used a "custom" URI for JSTL instead of the full one.
If you have created custom templates by copying magnolia samples or following the quick start guide, you have probably used this URI.

Therefore, for people migrating from 2.0 to 2.0.1 you will need to use the correct JSTL URI in your custom templates
OR add back the definition in web.xml (deprecated and not suggested).


The samples of 2.0.1 and have been fixed to contain the standard URI's.

Have fun.
Boris Kraft
the magnolia development team
]]>
                </source>
            </subsection>
        </section>

        <section name="Changes to JSTL and Expression Language between Magnolia 2.0 and 2.0x">
            <p>
                Between Magnolia 2.0 and 2.0x (and also 2.1) things changed in how JSTL (tags like
                <code>&lt;c:if&gt;</code>
                )and Expression Language (
                <code>${interesting==true}</code>
                ) are handled by Magnolia due to changes to the
                <code>web.xml</code>
                and libraries. These changes affect how the libraries and the JSP engine (Tomcat or
                other) interpret things.
                <p />
                Especially if your are migrating from 2.0 to any version above it, this can be quite
                tricky.
                <p />
                See below of how it was, and how it has to be.
            </p>
            <subsection name="Magnolia 2.0">
                <ul>
                    <li>JSP 1.2 (implied by the DTD on the web.xml)</li>
                    <li>
                        standard tag library (JSTL) in
                        <code>WEBINF/libs/standard.jar</code>
                        and
                        <code>WEBINF/libs/jstl.jar</code>
                        , version: 1.0

                    </li>
                    <li>
                        in your
                        <code>web.xml</code>
                        :
                    </li>
                </ul>
                <source>
                    <![CDATA[
<taglib>
  <taglib-uri>JSTL</taglib-uri>
  <taglib-location>/WEB-INF/taglib/c.tld</taglib-location>
</taglib>
]]>
                </source>

                <ul>
                    <li>
                        in your JSP:
                        <code>&lt;%@ taglib uri=&quot;JSTL&quot; prefix=&quot;c&quot; %&gt;</code>

                    </li>
                    <li>
                        in your
                        <code>WEBINF/taglibs</code>
                        : a file called
                        <code>c.tld</code>
                    </li>
                    <li>
                        EL is interpreted by code in the
                        <code>standard.jar</code>
                        . (And will not work with any other tags or inside your JSP itself)
                    </li>
                </ul>
            </subsection>
            <subsection name="Magnolia 2.0x">
                <ul>
                    <li>
                        JSP 2.0 (implied by the schema on the
                        <code>web.xml</code>
                        )
                    </li>
                    <li>
                        standard tag libary (JSTL) in
                        <code>WEBINF/libs/standard.jar</code>
                        and
                        <code>WEBINF/libs/jstl.jar</code>
                        , version: 1.1
                    </li>
                    <li>
                        in your
                        <code>web.xml</code>
                        : Nothing! (For JSTL, that is :- ) )
                    </li>
                    <li>
                        in your JSP:
                        <code>
                            &lt;%@ taglib
                            uri=&quot;http://java.sun.com/jsp/jstl/core&quot;prefix=&quot;c&quot;
                            %&gt;
                        </code>
                    </li>
                    <li>
                        in your
                        <code>WEBINF/taglibs</code>
                        : Nothing! (the
                        <code>.tld</code>
                        file is inside the
                        <code>standard.jar</code>
                        's
                        <code>META-INF</code>
                        folder.)

                    </li>
                    <li>EL is interpreted by the JSP engine. (Tomcat).</li>
                </ul>
                <p>
                    Especially note the 'jsp' inside the the taglib
                    <code>uri=&quot;http://java.sun.com/jsp/jstl/core&quot;</code>
                    if that is not there, like unfortunately in the examples with Magnolia 2.02, EL
                    will not work with a JSP 2.0
                    <code>web.xml</code>
                    which
                    <B>is</B>
                    included with 2.02.
                </p>
                <p>So you need to check:</p>
                <ul>
                    <li>
                        If you have the right JSTL library (
                        <A HREF="http://jakarta.apache.org/taglibs/doc/standard-doc/intro.html">
                            download
                        </A>
                        it from Apache if you have to);
                    </li>
                    <li>if you refer to it correctly from your JSP;</li>
                    <li>
                        and if your
                        <code>web.xml</code>
                        is correct.
                    </li>
                </ul>
            </subsection>
        </section>
    </body>
</document>